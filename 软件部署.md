# 软件部署 (Ubuntu 24.04)

本指南用于在一台全新的 Ubuntu 24.04 服务器上部署 `PegasusHospital` 系统。

## 一、 环境准备

### 1. 更新系统软件包
```bash
sudo apt update
```

### 2. 安装 Java 21 (JDK)
```bash
sudo apt install openjdk-21-jdk -y
```

### 3. 安装并配置 MariaDB 数据库
```bash
# 安装
sudo apt install mariadb-server -y

# 启动服务
sudo systemctl start mariadb
sudo systemctl enable mariadb

# 配置数据库账号
# 请确保这里的密码与项目中 db.properties 的密码一致！
# 项目配置为 user: root, password: root
sudo mysql -uroot -proot
```

在 MariaDB 命令行中执行：
```sql
-- 1. 设置 root 密码
ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';
FLUSH PRIVILEGES;

-- 2. 创建数据库
CREATE DATABASE IF NOT EXISTS pegasus_hospital DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 3. 退出
exit;
```

### 4. 导入初始数据
假设您已将源码包中的 `src/main/resources/database.sql` 上传至服务器当前目录。

```bash
# 导入表结构和测试数据
mariadb -u root -p pegasus_hospital < database.sql
# 输入刚才设置的密码
```

---

## 二、 Web 服务器部署 (Tomcat 10)

### 1. 安装 Tomcat 10
```bash
sudo apt install tomcat10 -y
```

### 2. 部署 WAR 包
```bash
# 1. 重命名为ROOT.war
mv PegasusHospital-1.0.war ROOT.war

# 2. 删除 Tomcat 默认的主页
sudo rm -rf /var/lib/tomcat10/webapps/ROOT

# 3. 移动 WAR 包到部署目录
sudo mv ROOT.war /var/lib/tomcat10/webapps/

# 4. 创建临时文件目录，用于文件上传和PDF生成
sudo mkdir -p /var/lib/tomcat10/webapps/ROOT/files
```

### 3. 重启服务
```bash
sudo systemctl restart tomcat10
```

---

## 三、 验证访问

**浏览器访问**：
*   地址：`http://localhost:8080/`
*   **测试管理员账号**：`admin` / `123456`
*   **测试患者账号**：`1000000001` / `123456`

---

## 四、 常见问题排查

1.  **数据库连接失败 (Access denied)**
    *   检查 `/var/lib/tomcat10/webapps/ROOT/WEB-INF/classes/db.properties` 文件中的密码是否与 MariaDB 设置一致。